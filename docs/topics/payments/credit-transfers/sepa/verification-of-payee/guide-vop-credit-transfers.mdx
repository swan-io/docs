---
title: VoP with credit transfers
---

# VoP with credit transfers

Use Verification of Payee (VoP) with credit transfers by including verification tokens in `initiateCreditTransfers`.

This guide shows how to enhance the standard [credit transfer flow](../sepa/guide-initiate-ct.mdx) with pre-verified beneficiaries.

:::warning Breaking Change
**Effective October 9, 2025:** The `beneficiaryVerification` query (Dutch IBANs only) is deprecated. Use `verifySepaBeneficiary` mutation instead for all SEPA IBANs.
:::

:::tip Prerequisites
1. You're an account member with the `canInitiatePayments` [membership permission](../../../accounts/memberships/index.mdx#permissions).
1. You've pre-verified beneficiaries using [`verifySepaBeneficiary`](./guide-verify-beneficiary.mdx).
1. You're authenticating with a [user access token](../../../../developers/using-api/authentication/index.mdx#tokens-user).
:::

## Single transfer with verification token {#single-transfer}

Include a verification token in a single credit transfer for faster processing and enhanced user experience.

1. Call the `initiateCreditTransfers` mutation.
1. Add the standard credit transfer information.
1. Include the `beneficiaryVerificationToken` from your pre-verification.
1. Add the consent URL to the success payload.

### Mutation {#single-mutation}

üîé [Open the mutation in API Explorer](https://explorer.swan.io?query=bXV0YXRpb24gU2luZ2xlV2l0aFRva2VuIHsKICBpbml0aWF0ZUNyZWRpdFRyYW5zZmVycygKICAgIGlucHV0OiB7CiAgICAgIGNvbnNlbnRSZWRpcmVjdFVybDogIiRZT1VSX1JFRElSRUNUX1VSTCIKICAgICAgYWNjb3VudElkOiAiJFlPVVJfQUNDT1VOVF9JRCIKICAgICAgY3JlZGl0VHJhbnNmZXJzOiB7CiAgICAgICAgYW1vdW50OiB7IHZhbHVlOiAiMTAwIiwgY3VycmVuY3k6ICJFVVIiIH0KICAgICAgICBzZXBhQmVuZWZpY2lhcnk6IHsKICAgICAgICAgIGliYW46ICJGUjc2MzAwMDYwMDAwMTEyMzQ1Njc4OTAxODkiCiAgICAgICAgICBuYW1lOiAiTWFyaWUgRHVib2lzIgogICAgICAgICAgaXNNeU93bkliYW46IGZhbHNlCiAgICAgICAgICBzYXZlOiBmYWxzZQogICAgICAgIH0KICAgICAgICBiZW5lZmljaWFyeVZlcmlmaWNhdGlvblRva2VuOiAiJFZFUklGSUNBVElPTl9UT0tFTiIKICAgICAgICBtb2RlOiBSZWd1bGFyCiAgICAgICAgcmVmZXJlbmNlOiAiSW52b2ljZSBwYXltZW50IgogICAgICB9CiAgICB9CiAgKSB7CiAgICAuLi4gb24gSW5pdGlhdGVDcmVkaXRUcmFuc2ZlcnNTdWNjZXNzUGF5bG9hZCB7CiAgICAgIF9fdHlwZW5hbWUKICAgICAgcGF5bWVudCB7CiAgICAgICAgaWQKICAgICAgICBzdGF0dXNJbmZvIHsKICAgICAgICAgIC4uLiBvbiBQYXltZW50Q29uc2VudFBlbmRpbmcgewogICAgICAgICAgICBjb25zZW50IHsKICAgICAgICAgICAgICBjb25zZW50VXJsCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC4uLiBvbiBCZW5lZmljaWFyeVZlcmlmaWNhdGlvblRva2VuQWxyZWFkeUNvbnN1bWVkUmVqZWN0aW9uIHsKICAgICAgdG9rZW4KICAgICAgbWVzc2FnZQogICAgfQogIH0KfQo%3D&tab=api)

```graphql {12,15} showLineNumbers
mutation SingleWithToken {
  initiateCreditTransfers(
    input: {
      consentRedirectUrl: "$YOUR_REDIRECT_URL"
      accountId: "$YOUR_ACCOUNT_ID"
      creditTransfers: {
        amount: { value: "100", currency: "EUR" }
        sepaBeneficiary: {
          iban: "FR7630006000011234567890189"
          name: "Marie Dubois"
          isMyOwnIban: false
          save: false
        }
        beneficiaryVerificationToken: "$VERIFICATION_TOKEN"
        mode: Regular
        reference: "Invoice payment"
      }
    }
  ) {
    ... on InitiateCreditTransfersSuccessPayload {
      __typename
      payment {
        id
        statusInfo {
          ... on PaymentConsentPending {
            consent {
              consentUrl
            }
          }
        }
      }
    }
    ... on BeneficiaryVerificationTokenAlreadyConsumedRejection {
      token
      message
    }
  }
}
```

### Success payload {#single-success}

When using a verification token, the response includes the payment with consent details:

```json {8,11} showLineNumbers
{
  "data": {
    "initiateCreditTransfers": {
      "__typename": "InitiateCreditTransfersSuccessPayload",
      "payment": {
        "id": "payment_01234567890abcdef",
        "statusInfo": {
          "__typename": "PaymentConsentPending",
          "consent": {
            "consentUrl": "https://identity.swan.io/consent?consentId=consent_123&env=Sandbox"
          }
        }
      }
    }
  }
}
```

## Automatic VoP fallback {#automatic-fallback}

If you don't include verification tokens, Swan automatically runs VoP for single transfers:

```graphql title="Single transfer without token (automatic VoP)" showLineNumbers
mutation AutomaticVoP {
  initiateCreditTransfers(
    input: {
      accountId: "$YOUR_ACCOUNT_ID"
      consentRedirectUrl: "$YOUR_REDIRECT_URL"
      creditTransfers: {
        amount: { value: "100", currency: "EUR" }
        sepaBeneficiary: {
          iban: "FR7630006000011234567890189"
          name: "Marie Dubois"
          isMyOwnIban: false
          save: false
        }
        mode: Regular
        reference: "Invoice payment"
      }
    }
  ) {
    ... on InitiateCreditTransfersSuccessPayload {
      payment {
        id
        statusInfo {
          ... on PaymentConsentPending {
            consent {
              consentUrl
            }
          }
        }
      }
    }
  }
}
```

Swan runs VoP in the background and displays results in the consent screen.

:::info Performance
Using verification tokens provides faster processing since VoP has already been completed. Pre-verification significantly improves user experience.
:::

## Error handling {#error-handling}

### Token already consumed {#error-consumed}

Verification tokens are single-use:

```json showLineNumbers
{
  "data": {
    "initiateCreditTransfers": {
      "__typename": "BeneficiaryVerificationTokenAlreadyConsumedRejection",
      "token": "vt_abc123...",
      "message": "This verification token has already been used"
    }
  }
}
```

**Solution**: Generate a new verification with `verifySepaBeneficiary`.

### Verification timeout {#error-timeout}

If VoP times out during automatic verification (without token):

```json showLineNumbers
{
  "result": {
    "__typename": "BeneficiaryVerificationNotPossible",
    "reason": "Technical timeout - verification service unavailable"
  }
}
```

**Solution**: The transfer can still proceed. Users will see a warning in the consent screen.

### Invalid token format {#error-invalid-token}

Malformed or expired tokens:

```json showLineNumbers
{
  "data": {
    "initiateCreditTransfers": {
      "__typename": "ValidationRejection",
      "message": "Invalid verification token format"
    }
  }
}
```

**Solution**: Ensure tokens are properly stored and not expired (24-hour limit).

## VoP in consent screen {#consent-display}

Swan automatically displays VoP results in the consent screen with clear user guidance:

### Match result ‚úÖ {#consent-match}
- **Display**: Green checkmark with "Beneficiary verified"
- **User action**: Can proceed with confidence
- **Payment flow**: No additional warnings

### Close Match result ‚ö†Ô∏è {#consent-close-match}
- **Display**: Warning icon with suggested name correction
- **Example**: "Did you mean 'John Smith' instead of 'Jon Smith'?"
- **User action**: Can proceed or go back to correct name
- **Payment flow**: Proceeds with warning if user confirms

### No Match result ‚ùå {#consent-no-match}
- **Display**: Warning about potential misdirected payment
- **Message**: "Name doesn't match bank records. Double-check beneficiary details."
- **User action**: Strongly advised to verify beneficiary details
- **Payment flow**: Proceeds with explicit warning if user confirms

### Verification Not Possible ‚ö†Ô∏è {#consent-not-possible}
- **Display**: Notice that verification couldn't be completed
- **Message**: "Verification unavailable due to technical issues. You can still proceed."
- **User action**: Can proceed with additional caution
- **Payment flow**: Proceeds with notice about unverified payment

## Best practices {#best-practices}

1. **Pre-verify for better UX** - Use `verifySepaBeneficiary` for faster processing
2. **Handle token expiry** - Verification tokens expire after 24 hours
3. **Display VoP results** - Show verification outcomes before payment submission
4. **Plan for errors** - Implement retry logic for verification failures

## Related guides {#related}

- [Verify a beneficiary](./guide-verify-beneficiary.mdx) - Create verification tokens
- [Sandbox testing](./sandbox.mdx) - Test VoP scenarios
- [API Reference](./api-reference.mdx) - Complete GraphQL documentation
- [Upcoming features](./upcoming-features.mdx) - Advanced VoP capabilities coming soon